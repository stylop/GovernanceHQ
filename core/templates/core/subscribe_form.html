{% load static %}


<form id="homepageNewsletterForm" action="{% url 'subscribe_newsletter' %}" method="post">
  {% csrf_token %}
  <div class="input-group mb-3">
    {{ newsletter_form.email }}
    <button class="btn btn-primary" type="submit" id="button-subscribe">Subscribe</button>
  </div>
  <div id="homepage-newsletter-messages" class="mt-2"></div>
</form>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const homepageForm = document.getElementById("homepageNewsletterForm");
  const homepageMessages = document.getElementById("homepage-newsletter-messages");

  if (homepageForm) {
    homepageForm.addEventListener("submit", function(e) {
      e.preventDefault();

      const formData = new FormData(homepageForm);

      fetch(homepageForm.action, {
        method: "POST",
        headers: {
          "X-Requested-With": "XMLHttpRequest",
          "X-CSRFToken": homepageForm.querySelector("[name=csrfmiddlewaretoken]").value,
        },
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        homepageMessages.innerHTML = "";

        let alertClass = data.status === "success" ? "alert-success" : "alert-danger";
        homepageMessages.innerHTML = `<div class="alert ${alertClass}">${data.message}</div>`;

        if (data.status === "success") {
          homepageForm.reset();
        }

        // ⏳ Auto-hide after 4 seconds
        setTimeout(() => {
          homepageMessages.innerHTML = "";
        }, 4000);
      })
      .catch(() => {
        homepageMessages.innerHTML = `<div class="alert alert-danger">Something went wrong. Try again later.</div>`;

        setTimeout(() => {
          homepageMessages.innerHTML = "";
        }, 4000);
      });
    });
  }
});

</script>

